dist: bionic
addons:
  apt:
    source:
    - docker-bionic
    packages:
    - docker
services:
- docker
env:
  global:
  - PROJECT: tokend
  - IMAGE_NAME: stellar-withdraw-svc
  - secure: PuFy8yQpc+6/WfulTIy4uypvbuc0uoMj8u6r0j9IOLnKGq1GzdI8I2DsxSgkpWVqqRaTPTRiNe37K1htaXgPBpjXrzjvZrbWut8l6ywqZCe5/5EUkqvbpQvIdTeNd/hJk1UHncd+f8u+W15jYqsPDNYUJ4JalBGzQYoZOHUAc7QeIUSsaR6TbOj62lPmrXhZJPEHrJWIH0h8Kfhch27FmuyyxKw2yvi96W/RNNaTJjMQPqqNDn8QE1dYiZMyOh8qGYNvBMi/yyEcVIpDCl0v9GZgPzBebc3kLMn6pohtAjWvVsowzbLhOxY0Puz3KW0Aaoi9Zl0iTMKvsmbm7Zbi/9nsnWZQGiBDLKJ2s5TOlPN+GBbip4/gwPppqmHoE5SHPgcRo1QjhsxDs8JdJedYLw39Fv1HVHKVmJl8qnNUKbHwSa3h78TJvs7k70nZFyW5SuJfr8jvFDz27/PYfMfucjacrCV/v2r1wg0gW8kOFLjA891wtPDb5ylo4PA9hOt/fAbja6Fr6c9LhLDNJKGTLCqCXwAQfziAeTgtGrt83DZLqdzmIxlQh6U1C91sbYiC9MtfNnT0XJIPN09ZPKloI/zC7wkFaVAzf68ZnEGeLME3k7Ge5WmpQIkQ1IcqKC1v3EtavAY2hOapPOaTG5PJ80eIPLHxvLw/Ef3z+ZyY5mY=
  - secure: Cv3wwAdydIqseFfRxR6axgSLug9MCi7/Y1xkbucQfs0iAeOOeR9ZVC4iUD99SkwhrD6k6PRR6ZqR9zHmLefo9WnaT3ylfXrQlDn8naliv9CjwKPajX2vG3RBJNX0phkD7WBJErYwgfkHzDUmcH78FWG8ZsICBXFjNlWHLEFUun3bm/S8mmPZhcJ5f+69JuMPqbY0fWP2DZyd3xA5y4CrYcqvxCLi+8UwONFATrO380539STeN/0WJ1MgwGZEi/bFCAcpgx96ZPDc74t4MDvyeoHboNwwBusNG3QHFzPc/TtlZ6rOmby+J8PAdMATyTy00mUbEoJ9nO87mwwW7Nn4ipXjCE2BlglFMDe5nwe2eM5ij79p43ElGfsBGIKx4EXNeczdK/8tvtCoZKUnouuw2i2Ir6KBis2P4BRV0yc05xoJgaCNu5b/AqC9rs5PNsSPwB1CK1kxGuoIE5iLBBCLVbenE6daSqEvoDsAEslB1TMUMN7kz4LZGWTqvtyqtaqbRzu7i6qbOUm/5AwyQih7yOUnMwOmV7HSga2UitHIAIuTYVNaXIZSvqGHPjszqY7a2HAbq5XrtGgvyRF2EnQUvIIE6SZRJEoxHGt2xp/k7GFQVZa3V3EdtmIIuh68oyJpxSNaxub0Ijb9Dr7DfOBnUQ7y4bqmkOckB39aExAa1H8=
  - secure: skiN8H0KnfePbi4d8z5Jzka//wFKPWfoCG0KY+1AcZMjn62B8jZwnEMJpJJWhTita+FK1yKdDfnDS2PiyXDChNUsXDZ7rPAWJboFwwleTWb4cplp5m+alecLcyvdYhTYe8dcJvf2ZeCOmJpeoq3V8z/KFHyaessjWK5TZLkPg8JOZ5ecOa9uxubDh/fXuncJW47Da2YWJjNEpogIqKlyJuoUvg+KBq1Ms5NEBODfyONnWcaSpEcP41hDkQ4B6j4dACPxXHZdCY2M2/Da5LRFDj+Kqi/ftTLkBvHCPvseirkXhLczW+6Y2XjAw7SwXg5oHpJMoUMBat4WrdRJv8KQapU81rvkpBkZWYoudrPtkBEJHUSFNXbNDk71FuaWMUHziIRXrpMPvUcgLQYeFX/dxp2FiJrbn38Hz2QdrcR5foUZDGBW4+FkoOKgh6KLHkoOiG7Fx/hBXVPqkOK3qWjzMXyAEPfnWhlcOa9O4YSTWJn0LwK9dWdtbyzCUKHNpUbaroix6NekrcKIZtbP4ABzuxc6e8QjX34T1do11mArF+4OVxqfSNBFIaf7wtGRTh6AQdSZTdwNMgOb8TRnWk3MSvQ+IQGhgSvVJB3zTbBkQXTnmHBddGjy9LMEkkzeagH0y7tzGyB1uTci41QjXIAYO3F1DvK4OUYZRuBarnrA7RM=
  - secure: mRflghrItCsNSkTy/7UDZ0BV9rvn5pM2vNcchbLsRW7vqY8Hz2adkhH5P5KCtkIPkBDJ+1a5x6/pHe6vFawrtUgfEuCl/ualZEUJls3yXAv+mTWchlo+TeoTA8Avogte/XR7NptBZo9s78HEppFyM5Y4v7OMtvjCYW/gRvI563b7rd2uGsjxd1p8kH5hRkMhD0OFqcIXnPI9wernks/sIjXSpBzzALLMLbpOXOsMv4dV1+Cv78TvKHIYrUOR9NbmKFSdxmAUlijEY122FzOmwuM4i/tYGiFVRM91Wksu6K+OszVXd07s2C/PZbfXCKDmBwf/aMIyhs+BtV7bO9XJo+ZBhgeejcql/bVhCkO+jFWBl2eZ/5/1pbThmY8yRdmDUOMqPe0a0HsSnVSLqreesVT+JaGiT1i7UddXsGbnBS9Sp0Y+AiG9T5uhWS1251oeegT6RyM3X/itomWz3+6u3jAojZ+6ynFYUZ0rc99pUIcyHu+NvLE4Q4llWq1kfUTr2mXmVlLGz2U5u3I0mT9CdJWrNOpk3qFS9NRK/R7PNZmEzmT2bN/K56perPEyd9sLnk2HwO/LxcWvLTzHFidIItb0/ATPiFl9CGz5+LLT9DbSkVEuM+MY9B9numhuAkGTFuuKKu3Q8eLCO1syGSdPc0KTgwJNTazPEjG3cUA+0mg=
script:
- export IMAGE_TAG=$(test -z $TRAVIS_TAG && echo $TRAVIS_COMMIT || echo $TRAVIS_TAG)
- docker build -t $PROJECT/$IMAGE_NAME:$IMAGE_TAG .
before_deploy:
- echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
- echo "$GITLABREG_PASSWORD" | docker login -u "$GITLABREG_USERNAME" --password-stdin
  registry.gitlab.com
- docker tag $PROJECT/$IMAGE_NAME:$IMAGE_TAG registry.gitlab.com/$PROJECT/docker-registry/$IMAGE_NAME:$IMAGE_TAG
deploy:
- provider: script
  script:
  - docker push $PROJECT/$IMAGE_NAME:$IMAGE_TAG
  on:
    all_branches: true
    tags: true
- provider: script
  script:
  - docker push registry.gitlab.com/$PROJECT/docker-registry/$IMAGE_NAME:$IMAGE_TAG
  on:
    all_branches: true
    tags: false
